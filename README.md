# Tiptap 富文本编辑器项目

基于 React 18 和 Tiptap 构建的功能丰富的 WYSIWYG Markdown 编辑器，支持多种交互功能和 AI 辅助编辑。

## TODO LIST

### ✅ 核心编辑器功能
- [x] **基础编辑器设置** - 基于 Tiptap 和 StarterKit 的富文本编辑器
- [x] **Markdown 支持** - 使用 marked 库解析初始 Markdown 内容
- [x] **基础格式化** - 支持粗体、斜体、删除线、代码等基本格式
- [x] **列表支持** - 有序列表和无序列表
- [x] **引用块** - 支持引用块格式
- [x] **代码块** - 支持代码块和行内代码
- [x] **链接功能** - 基础链接插入和编辑

### ✅ 斜杠命令系统
- [x] **自定义斜杠命令节点** - 使用自定义节点而非 @tiptap/suggestion 插件
- [x] **智能触发** - 仅在行首或空格后输入 '/' 时触发
- [x] **实时搜索过滤** - 根据输入内容实时过滤命令列表
- [x] **键盘导航** - 支持上下箭头键选择命令
- [x] **双空格退出** - 输入两个连续空格时退出命令模式
- [x] **Enter 键退出** - 当搜索内容无匹配时按 Enter 退出
- [x] **自动聚焦** - 节点插入时自动聚焦输入框
- [x] **失焦退出** - 输入框失去焦点时自动退出并保留输入内容
- [x] **命令执行** - 支持标题1-3、列表、引用等命令

### ✅ 链接交互功能
- [x] **悬浮菜单** - 鼠标悬浮链接时显示操作菜单
- [x] **URL 显示** - 在菜单中显示完整链接地址
- [x] **编辑功能** - 点击编辑按钮打开详细编辑面板
- [x] **复制功能** - 一键复制链接 URL
- [x] **删除功能** - 在编辑面板中删除链接
- [x] **动态定位** - 使用 getBoundingClientRect() 动态计算菜单位置
- [x] **边缘检测** - 防止菜单超出屏幕边界
- [x] **编辑锁定** - 编辑模式下菜单锁定，不响应鼠标离开事件
- [x] **全屏遮罩** - 编辑时显示透明遮罩层，点击外部关闭
- [x] **防止滚动** - 编辑面板打开时阻止页面滚动

### ✅ 文本选择和 AI 建议
- [x] **选择检测** - 鼠标释放后检测文本选择
- [x] **格式化按钮** - 粗体、斜体、删除线快速格式化
- [x] **AI 询问功能** - "询问" 按钮触发 AI 建议输入
- [x] **选择高亮** - 使用 span 元素包装选中文本并高亮显示
- [x] **跨节点选择** - 支持跨多个节点的文本选择
- [x] **智能替换** - 区分单个列表项和多个列表项的替换策略
- [x] **开放切片** - 使用 openStart 和 openEnd 防止嵌套列表创建
- [x] **浏览器默认高亮** - 保持浏览器默认的文本选择高亮效果
- [x] **选择分析** - 分析选择范围内涉及的所有节点和内容
- [x] **DOMSerializer 序列化** - 将选择内容序列化为 HTML 供 AI 处理

### ✅ 悬浮图标和 AI 处理
- [x] **段落悬浮图标** - 鼠标悬浮段落时显示 "+" 图标
- [x] **动态定位** - 图标位置根据段落位置动态计算
- [x] **高亮效果** - 悬浮时显示段落背景高亮
- [x] **锁定状态** - 点击图标后锁定高亮状态
- [x] **气泡卡片** - 点击图标显示 AI 处理输入框
- [x] **外部点击关闭** - 点击卡片外部区域关闭
- [x] **键盘快捷键** - Enter 提交，Escape 关闭
- [x] **加载状态** - 处理过程中显示加载动画
- [x] **节流处理** - 使用 lodash.throttle 优化鼠标移动性能
- [x] **延迟隐藏** - 鼠标离开后延迟隐藏图标和高亮

### ✅ 固定标题功能
- [x] **固定一级标题** - 编辑器第一个元素为不可删除的一级标题
- [x] **自定义节点** - 使用 FixedTitleNode 扩展实现
- [x] **高优先级** - 设置高优先级确保在标准 heading 之前处理
- [x] **特殊属性** - 使用 data-fixed-title="true" 标识
- [x] **占位符支持** - 支持自定义占位符文本
- [x] **样式定制** - 专门的 CSS 样式用于固定标题显示

### ✅ Markdown 粘贴功能
- [x] **智能检测** - 自动检测粘贴内容是否包含 Markdown 语法
- [x] **语法识别** - 识别标题、列表、引用、代码块、链接等语法
- [x] **自动转换** - 使用 marked 库将 Markdown 转换为 HTML
- [x] **ProseMirror 集成** - 使用 DOMParser 和 Slice 正确插入内容
- [x] **错误处理** - 转换失败时回退到默认粘贴行为

### ✅ 扩展和插件
- [x] **SelectionHighlight 扩展** - 自定义文本选择高亮标记
- [x] **SlashCommandNode 扩展** - 自定义斜杠命令节点
- [x] **FixedTitleNode 扩展** - 固定标题节点
- [x] **MarkdownPaste 扩展** - Markdown 粘贴处理
- [x] **Link 扩展配置** - 链接扩展的自定义配置

### ✅ 工具函数和 Hooks
- [x] **useHoverIcon Hook** - 悬浮图标状态管理
- [x] **textSelectionProcessor** - 文本选择处理工具
- [x] **textProcessor** - 文本处理工具
- [x] **节流优化** - 使用 lodash.throttle 优化性能